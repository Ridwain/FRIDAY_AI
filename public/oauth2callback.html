<!DOCTYPE html>
<html>
<head>
  <title>OAuth2 Redirect</title>
</head>
<body>
  <script>
    // This page receives Google's OAuth redirect with access token in URL hash.
    // It passes the token back to the extension and closes itself.

    (function() {
      // Parse access_token from URL fragment
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const accessToken = params.get('access_token');
      const error = params.get('error');

      if (accessToken) {
        // Send token to extension via postMessage
        window.opener.postMessage({ type: 'oauth2callback', accessToken }, '*');
        window.close();
      } else if (error) {
        window.opener.postMessage({ type: 'oauth2callback', error }, '*');

        window.close();
      } else {
        document.body.textContent = 'No access token found.';
      }
    })();
  </script>
</body>
</html>


